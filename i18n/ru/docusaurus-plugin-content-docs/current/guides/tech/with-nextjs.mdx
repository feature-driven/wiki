---
sidebar_position: 10
---

import WIP from '@site/src/shared/ui/wip/tmpl.mdx'

# Использование с NextJS

<WIP ticket="225" />

> Про специфику фреймворка и совместимость с методологией

NextJS хорошо работает с FSD, но возникают конфликты из-за различий между требованиями к структуре проекта NextJS и принципами FSD.
А именно, в двух пунктах: 

- Маршрутизация файлов в слое `pages`
- Конфликт или отсутствие слоя `app` в NextJS

## Конфликт между FSD и NextJS в слое `pages` {#pages-conflict}

NextJS предлагает использовать директорию `pages` для определения маршрутов приложения. По умолчанию NextJS ожидает, что файлы в директории `pages` будут соответствовать определенным URL-адресам.
Этот механизм маршрутизации **не соответствует** концепции FSD, поскольку это может привести к смешиванию функциональности различных модулей в одном файле.

### Перемещение директории `pages` NextJS в корневую директорию проекта (рекомендуется)

Подход заключается в перемещении директории `pages` NextJS в корневую директорию проекта, сохраняя
при этом структуру проекта FSD внутри папки "src", и импорте страниц FSD в директорию `pages` NextJS.

```sh
├── pages              # Директория pages (NextJS)
├── src
│   ├── app
│   ├── entities
│   ├── features  
│   ├── pages          # Директория pages (FSD)
│   ├── shared
│   ├── widgets
```

### Переименование директории `pages` в структуре FSD

Другой способ решить проблему - переименовать слой `app` в структуре FSD, чтобы избежать конфликтов с директорией `pages` NextJS.
Вам следует переименовать слой `app` в FSD в `pages-flat`. 
Таким образом, структура проекта в директории `src` будет сохранена, не вступая в противоречие с требованиями NextJS.

```sh
├── app
├── entities
├── features  
├── pages              # Директория pages (NextJS)
├── pages-flat         # Переименованная директория страниц FSD
├── shared
├── widgets             
```

## Отсутствие слоя `app` в NextJS {#app-absence}

В NextJS ниже версии 13 нет явного слоя `app`, вместо этого NextJS предоставляет файл `_app.tsx`,
который играет роль общего компонента обертывания для всех страниц проекта.

### Импорт функциональности в `pages/_app.tsx`

Чтобы решить проблему, вам следует создать компонент внутри слоя `app` и импортировать его в файл "pages/_app.tsx", чтобы NextJS мог с ним работать.
Например:

```tsx
// app/index.tsx

const App = ({ Component, pageProps }: AppProps) => {
  return (
    <Provider1>
      <Provider2>
        <BaseLayout>
            <Component {...pageProps} />
        </BaseLayout>
      </Provider2>
    </Provider1>
  );
};

export default App;
```
Необходимо импортировать созданный компонент `App` и глобальные стили проекта в `pages/_app.tsx` следующим образом:

```tsx
// pages/_app.tsx

import 'app/styles/index.scss'

export { default } from 'app';
```

## Работа с App Router {#app-router}

App Router стал стабильным в NextJS версии 13.4. App Router позволяет использовать директорию `app` для маршрутизации вместо директории `pages`.
Чтобы соответствовать принципам FSD, вам следует обращаться с директорией `app` NextJS таким же образом, как рекомендуется
для устранения конфликта с директорией `pages` NextJS.

Подход заключается в перемещении директории `app` NextJS в корневую директорию проекта, сохраняя
при этом структуру FSD внутри папки "src", и импорте страниц FSD в директорию `app` NextJS.

```sh
├── app                # Директория app (NextJS)
├── src
│   ├── app            # Директория app (FSD)
│   ├── entities
│   ├── features  
│   ├── pages
│   ├── shared
│   ├── widgets
```

## См. также {#see-also}

- [(Тред) Про pages директорию в NextJS](https://t.me/feature_sliced/3623)
